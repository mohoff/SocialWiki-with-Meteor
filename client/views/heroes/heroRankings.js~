Template.heroRankings.helpers({
  rankingCategory: function(){
    return UI._globalHelpers['getRankingCategory']();
  },
	heroes: function() {
		var heroes;
    var searchQuery = Session.get("searchQuery");

		if(searchQuery){
			var searchQueryRegExp = new RegExp(searchQuery, 'i');
   		heroes = Heroes.find({
				$or: [
					{'hero.name': searchQueryRegExp},
		  		{'hero.surname': searchQueryRegExp},
		      {'hero.type': searchQueryRegExp},
		      {'hero.badges': searchQueryRegExp},
		      {'hero.attributes': searchQueryRegExp}
				]
			});
		} else {
			heroes = Heroes.find({});
		}
    return heroes;
	}
});

Template.heroRankings.rendered = function(){
	var query = Session.get('searchQuery');
	if(query){
		$('#search').val(query);
	}
	$('#search').change(function(){
		var val = $(this).val();
		Session.set('searchQuery', val);
	});
	$('#search').keypress(function(e) {
    if(e.which == 13) {
			$(this).blur();
    }
	});
};
